
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  firstName     String
  lastName      String
  password      String
  email         String   @unique
  accountNumber String?
  bankName      String?
  accountName   String?
  salary        Float?
  currency      String
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  transactions  Transactions[]
}

model Transactions {
  id                   String   @id @default(cuid())
  userId               String   @map("user_id")
  narration       String
  amount               Float
  currency             String
  accountNumber   String
  status               String
  transactionReference String @unique @map("transaction_reference")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  user                 User              @relation(fields: [userId], references: [id])
  logs                 TransactionLogs[]
  retries              TransactionRetries[]

  @@index([userId, createdAt])
  @@index([transactionReference])
}

model TransactionLogs {
  id            String   @id @default(cuid())
  transactionId String   @map("transaction_id")
  status        String
  isRetry       Boolean  @default(false)
  providerResponse Json?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  transaction   Transactions @relation(fields: [transactionId], references: [id])
}

model TransactionRetries {
  id            String   @id @default(cuid())
  transactionId String   @map("transaction_id")
  retryCount    Int      @default(0)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  transaction   Transactions @relation(fields: [transactionId], references: [id])
}
